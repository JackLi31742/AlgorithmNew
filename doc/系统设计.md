Redis和Memcached整体对比
1）性能对比：由于Redis只使用单核，而Memcached可以使用多核，所以平均每一个核上Redis在存储小数据时比Memcached性能更高。而在100k以上的数据中，Memcached性能要高于Redis，虽然Redis最近也在存储大数据的性能上进行优化，但是比起Memcached，还是稍有逊色。
2）内存使用效率对比：使用简单的key-value存储的话，Memcached的内存利用率更高，而如果Redis采用hash结构来做key-value存储，由于其组合式的压缩，其内存利用率会高于Memcached。
3）Redis支持服务器端的数据操作：Redis相比Memcached来说，拥有更多的数据结构和并支持更丰富的数据操作，通常在Memcached里，你需要将数据拿到客户端来进行类似的修改再set回去。这大大增加了网络IO的次数和数据体积。在Redis中，这些复杂的操作通常和一般的GET/SET一样高效。所以，如果需要缓存能够支持更复杂的结构和操作，那么Redis会是不错的选择。



如果一个用户没有进行登录或者注册，如何识别两次 Request 来自同一个用户呢？

IP Address 是不可以的，因为在同一个局域网下的不同用户会共享同一个对外的 IP Address。

正确的做法，是为用户生成一个 uuid （Universal Unique ID）作为他的标识，有很多库函数可以生成这个 uuid，这是一个字符串，可以认为不同的用户一定会生成不同的 uuid。服务器端生成这个 uuid 之后返回给浏览器端，浏览器端存储在 cookie 里，之后每次请求都会带上。如果服务器发现 cookie 里没有这个 uuid 就说明可能是一个新用户，就为其分配新的 uuid，否则不改变这个 uuid。这样我们就可以用 uuid 来识别一个未登录的用户了。

这样的方法如果你清空 cookie 或者换了浏览器以后，可能会被分配到一个新的 uuid，那么你之前的 requests 和之后的 requests 就可能会被服务器识别为两个不同的用户。这个是没有办法解决的了。因为神仙也无法知道你换了浏览器以后坐在电脑前的是不是还是你自己。

RPS = Requests Per Seocnd (to web server)
QPS = Queries Per Second (to database)
IOPS = I/O Per Second (to disk)





Consistent hashing 和 Load Balancing 不是一个意思。Consistent hashing 会让同样的 Request 去同一个 Server，Load Balancing 可能会让同样的 Request 去不同的 Server。

Web Server 上只存代码不存数据，是 stateless 的，更适合 Load Balancing。而 Database 上存数据，且我们希望每个 Database server 能拆分开存储所有数据，因此 Database 是 stateful 的，更适合 Consistent Hashing。当然如果你想把 Consistent Hashing 用在 Web Server 也是可以的，这样的好处是有时候 Web Server 上会有一些 Local Cache 用与降低 cache miss，那么同样数据的请求经过同一个 Web Server 会更好。



新鲜事系统

News Feed 是指我关注的人的信息流汇总，也就是你朋友圈里看到的数据。

```
id - primary key， 系统自动生成的unique id
owner_id - Foreign key，放在谁的 news feed 里
post_id - Foreign key，帖子的 id
posted_by_user_id - Foreign key，谁发的
created_at - timestamp，啥时候发的，用于排序
...
```

Timeline 是某个人发的所有的帖子的汇总。就是点到某个人的朋友圈以后看到的他/她发的所有帖子。TImeline 其实就是 Post Table 按照时间排序，

```
id - primary key，系统自动生成的 unique id
user_id - foreign key， 谁发的
content - text，发了啥
created_at - timestamp，啥时候发的
...
```





流控方案

https://mp.weixin.qq.com/s/Uk90GWr6VQdPQJr7hJE4wg



[一致性哈希算法及其在分布式系统中的应用](http://blog.codinglabs.org/articles/consistent-hashing.html)